<html>
<head>
	<title>注册-大学生二手交易网</title>
	<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css"
	href="./static/css/registercss.css" />
</head>
<body>

	<div class="row up-div">
		<h1 class="myh font h">校园二手网</h1>
	</div>
	<div class="registerMain-div">
		<div>
			<h1 class="myh">用户注册</h1>
		</div>
		<div class="row">
			<input type="text" id="phoneNumber" name="phoneNumber"
			placeholder="请输入手机号" autocomplete="off" class="input">
		</div>
		<div class="row">
			<input type="password" id="password" name="password"
			placeholder="请输入密码" autocomplete="off" class="input">
		</div>
		<div class="row">
			<input type="password" id="repassword" name="repassword"
			placeholder="请重复输入密码" autocomplete="off" class="input">
		</div>
		<div class="row">
			<input type="text" id="checkCode" name="checkCode"
			placeholder="请输入短信验证码" autocomplete="off" class="input phoneCod">
			<button id="myButton" class="btn btn-success getbtn" onclick="getCheckCode()">获取验证码</button>
		</div>
		<div class="row">
			<button type="submit" class="btn btn-success mybtn" onclick="register()">注册</button>
		</div>
		<div class="row">
			<a class="btn btn-success mybtn" href="http://localhost:8080/ssm_graduation/skip/login.action">返回登录</a>
		</div>
	</div>
</body>
</html>

<script language="JavaScript">

	function startCountDown() {
		$('#myButton').text(60)
		var myVar = setInterval(function() {
			$('#myButton').text($('#myButton').text() - 1)
			if ($('#myButton').text() === '0') {
				clearInterval(myVar)
				$('#myButton').text('重新发送')
				$('#myButton').removeAttr('disabled')
			}
		}, 1000)
		$('#myButton').attr('disabled', 'disabled')
	}

//获取验证码
function getCheckCode() {
	if(isPhoneNum()){
		startCountDown();
		var phoneNumber = $("#phoneNumber").val();
		$.ajax({
			type : "POST",
			data : {
				"phoneNumber" : phoneNumber
			},
			dataType: "json",  
			url : "http://localhost:8080/ssm_graduation/register/getCheckCode.action",
			success : function(data) {
				alert(data.state);
			},
			error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert("in error");
			},
			complete : function() {
				alert("in complete");
			}
		});
	}
	else{
		alert('请输入有效的手机号码！'); 
	}
}

//验证手机号码格式
function isPhoneNum(){
	var phonenum = $("#phoneNumber").val();
	var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/; 
	if(!myreg.test(phonenum)){ 
		return false; 
	}else{
		return true;
	}
}
</script>